# 1C:Drive Test Helper
### Помощник для тестов 1С:Drive
[![Версия](https://img.shields.io/badge/version-1.0.0-blue)](./package.json) 

<p align="center">
  <img src="./res/1CDriveTestHelper.png" alt="Иконка 1C:Drive Test Helper" width="128"/>
</p>


Помощник для разработки и управления регрессионными тестами 1C:Drive в VS Code. Ускоряет навигацию между сценариями, создание новых сценариев по шаблонам и управление фазами для тестовых запусков.

## Возможности

* **Быстрая Навигация:**
    * **Переход к определению сценария:** Находясь на строке вида `And ИмяСценария`, нажмите комбинацию клавиш (`Command+Option+=` или `Ctrl+Alt+=`) или выберите пункт в контекстном меню, чтобы быстро открыть `.yaml` файл, где определено `Имя: "ИмяСценария"`.
    * **Поиск всех использований сценария:** Откройте файл сценария (`scen.yaml`), кликните правой кнопкой мыши в любом месте текущего сценария и выберите "1C:Drive - Найти вызовы текущего сценария" или используйте комбинацию `Ctrl+Alt+J` или `Command+Option+J`. Расширение покажет список всех мест (`And Имя...`), где используется этот сценарий, в виде удобного списка QuickPick.

* **Создание Сценариев по Шаблонам:**
    * **Создать вложенный сценарий:**
        * Вызывается из контекстного меню или палитры команд (`1C:Drive - Создать вложенный сценарий`).
        * Запрашивает Имя (может предзаполняться, если команда вызвана с заранее написанной строки вызова `And ...`), Номерной код теста и Родительскую папку.
    * **Создать главный сценарий:**
        * Вызывается из контекстного меню или палитры команд (`1C:Drive - Создать главный сценарий`).
        * Запрашивает Имя главного сценария, **метаданные для Phase Switcher** (Имя фазы/вкладки, Порядок сортировки, Состояние по умолчанию) и Родительскую папку.
        * Автоматически создает структуру:
            * `<Родительская папка>/<Имя>/scen.yaml`
            * `<Родительская папка>/<Имя>/test/<Имя>.yaml`

* **Вставка Кода (Сниппеты):**
    * **Вставить ссылку на вложенный сценарий:** Быстро вставляет блок для `ВложенныеСценарии` (вызывается по `Ctrl+Alt+N` или `Command+Option+N` или из контекстного меню).
    * **Вставить параметр сценария:** Быстро вставляет блок для `ПараметрыСценария` (вызывается по `Ctrl+Alt+M` или `Command+Option+N` или из контекстного меню).
    * **Вставить новый UID:** Генерирует и вставляет новый UUID v4 в текущую позицию курсора (вызывается по `Ctrl+Alt+U` или `Command+Option+U` или из контекстного меню).

* **Phase Switcher:** 

    Развитие приложения [Phase Switcher](https://github.com/kakoytochelik/PhaseSwitcher) внутри расширения для VS Code.
    <br>Главное отличие - больше нет необходимости во внешних файлах конфигурации, все происходит автоматически!

    <table>
    <tr>
        <td valign="top"> 
        <ul>
            <li><b>Открытие:</b> Нажмите на иконку расширения <img src="./res/activity_icon_mini.png" height="16" alt="Иконка" style="vertical-align: bottom;"> в боковой панели (Activity Bar).</li>
            <li><b>Назначение:</b> Позволяет быстро включать и выключать наборы тестов для разных запусков.</li>
            <li><b>Обнаружение тестов:</b> Расширение сканирует папку <code>tests/RegressionTests/Yaml/Drive/</code> (VS Code должен быть открыт в корне проекта!).</li>
            <li><b>Метаданные тестов:</b> Для отображения теста, файл <code>scen.yaml</code> должен содержать <code>Имя: "Имя теста"</code> и маркеры:
            <pre><code class="language-yaml">
            # PhaseSwitcher_Tab:        Название Вкладки (Обязательно)
            # PhaseSwitcher_Default:    true/false (Необязательно)
            # PhaseSwitcher_OrderOnTab: Число (Необязательно)</code></pre>
            </li>
            <li><b>Интерфейс:</b>
            <ul>
                <li>Группировка по фазам в выпадающем списке.</li>
                <li>Чекбоксы показывают состояние (вкл/выкл/не найден).</li>
                <li><b>Жирный шрифт</b> - измененное состояние.</li>
                <li>Кнопки:
                <ul>
                    <li><code>Обновить</code>: Пересканировать файлы.</li>
                    <li><code>Переключить все</code>: Переключить все активные тесты.</li>
                    <li><code>Переключить фазу</code>: Переключить тесты в текущей фазе.</li>
                    <li><code>По умолчанию</code>: Сбросить все к дефолтному состоянию.</li>
                    <li><code>Применить изменения</code>: Переместить папки <code>./test/</code>.</li>
                </ul>
                </li>
                <li>Статус-бар отображает текущий статус.</li>
            </ul>
            </li>
        </ul>
        </td>
        <td width="300" valign="top" align="center" style="padding-left: 20px;"> <img src="./res/PhaseSwitcherUI.png" alt="Скриншот PhaseSwitcher" width="300"/>
        <br>
        <em>Интерфейс PhaseSwitcher</em>
        </td>
    </tr>
    </table>

## Требования

* Visual Studio Code
* Проект открыт в VS Code так, чтобы корень проекта соответствовал ожидаемой структуре (например, содержал папки `tests` и `RegressionTests_Disabled`).
* Для сборки Node.js и npm.

## Использование

1.  **Установка:**
    * Или: Extensions View -> "..." -> "Install from VSIX..." -> Выберите скачанный/собранный `.vsix` файл.
2.  **Команды:**
    * Большинство команд доступны через **контекстное меню** (правый клик в редакторе) или **палитру команд** (`Ctrl+Shift+P` или `Command+Shift+P`, начните вводить `1C:Drive`).
    * Для навигации и вставки могут использоваться **горячие клавиши** (проверьте или настройте их в Keyboard Shortcuts).
3.  **Phase Switcher:**
    * Откройте через **иконку <img src="./res/activity_icon_mini.png" height="20" alt="Иконка" style="vertical-align: bottom;"> в Activity Bar**.
    * Выберите нужную фазу из выпадающего списка.
    * Отметьте/снимите отметки у тестов. Названия измененных тестов станут жирными.
    * Нажмите `Применить изменения`.
    * Используйте `Обновить`, если вы вручную изменили структуру папок тестов.


## Известные Проблемы

* При создании нового Главного сценария, список тестов в Phase Switcher нужно обновить вручную через кнопку `Обновить`

## История Изменений

См. `CHANGELOG.md`